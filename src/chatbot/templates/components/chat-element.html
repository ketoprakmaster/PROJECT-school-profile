<div class="fixed bottom-6 left-6 z-50">
    <button
        onclick="document.getElementById('chat-window').classList.toggle('hidden')"
        class="btn btn-circle btn-primary shadow-2xl hover:scale-110 transition-transform"
    >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" /></svg>
    </button>
</div>

<div id="chat-window" class="fixed bottom-24 left-6 w-96 max-h-[600px] h-[70vh] z-50 flex flex-col shadow-2xl transition-all">
    <div class="card bg-base-100 border border-base-300 h-full flex flex-col overflow-hidden">

        <div class="bg-primary text-primary-content p-4 flex items-center justify-between">
            <div>
                <h2 class="font-bold">Company AI</h2>
                <div class="flex items-center gap-1.5">
                    <span class="badge badge-success badge-xs"></span>
                    <span class="text-[10px] opacity-80">Always Online</span>
                </div>
            </div>
            <button onclick="document.getElementById('chat-window').classList.add('hidden')" class="btn btn-ghost btn-xs btn-circle">âœ•</button>
        </div>

        <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 scroll-smooth">
            <div class="chat chat-start">
                <div class="chat-bubble chat-bubble-primary shadow-sm">
                    Hi! How can I help you today?
                </div>
            </div>
        </div>

        <div id="loading-spinner" class="htmx-indicator px-4 py-2">
            <div class="flex items-center gap-2 text-sm text-gray-500">
                <span class="loading loading-dots loading-sm"></span>
                AI is thinking...
            </div>
        </div>

        <div class="p-4 border-t border-base-content/20 bg-base-200/50">
            <form
                hx-post="{% url 'chatbot:default' %}"
                hx-target="#chat-messages"
                hx-swap="beforeend"
                hx-indicator="#loading-spinner"
                class="flex gap-2"
            >
                {% csrf_token %}
                <input
                    id="chat-input"
                    name="user-message"
                    type="text"
                    placeholder="Type a message..."
                    class="input input-bordered w-full focus:outline-none"
                    required
                    autocomplete="off"
                />
                <button type="submit" class="btn btn-primary">
                    Send
                </button>
            </form>
        </div>
    </div>
</div>

<script>
document.body.addEventListener('htmx:afterSwap', function(evt) {
    const objDiv = document.getElementById("chat-messages");
    objDiv.scrollTop = objDiv.scrollHeight;
});
</script>
